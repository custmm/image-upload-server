<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Ɐ휴욱슈욱Ɐ >> 태그결과과</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      position: relative;
    }

    h2 {
      color: #1da1f2;
      margin-bottom: 20px;
      text-align: center;
    }

    .post-list {
      list-style: none;
      padding: 0;
    }

    .post-list li {
      background: #f7f7f7;
      padding: 15px;
      margin-bottom: 10px;
      border-left: 5px solid #1da1f2;
      border-radius: 4px;
    }

    .post-list li a {
      color: #333;
      text-decoration: none;
    }

    .post-list li a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
    <button id="backToListButton" class="back-button">뒤로가기</button>
      <h2 id="tagTitle">#태그 관련 게시물</h2>
    <ul class="post-list" id="postList"></ul>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const tag = new URLSearchParams(location.search).get("tag");
        const tagTitle = document.getElementById("tagTitle");
        const postList = document.getElementById("postList");

        if (!tag) {
          tagTitle.textContent = "❌ 태그 없음";
          return;
        }

        tagTitle.textContent = `#${tag} 관련 게시물`;

        try {
          const res = await fetch(`/api/search?tag=${encodeURIComponent(tag)}`);
          const data = await res.json();

          let posts = data.posts;

        // ✅ 단일 객체 혹은 빈 객체일 때 배열로 처리
        if (!Array.isArray(posts)) {
          if (!posts || Object.keys(posts).length === 0) {
            posts = [];
          } else {
            posts = [posts];
          }
        }

          if (!data.posts || data.posts.length === 0) {
            postList.innerHTML = "<li>관련 게시물이 없습니다.</li>";
            return;
          }

          postList.innerHTML = data.posts.map(post => `
            <li>
              <a href="post.html?file=${encodeURIComponent(post.file_name)}&category=${encodeURIComponent(post.category_name)}&subcategory=${encodeURIComponent(post.subcategory_name)}">
                ${post.file_description}
              </a>
            </li>
          `).join('');
        } catch (err) {
          console.error("❌ 검색 중 오류:", err);
          postList.innerHTML = "<li>검색 오류가 발생했습니다.</li>";
        }
      });
      // ✅ "목록으로" 버튼 클릭 시 이전 페이지로 이동
      document.getElementById("backToListButton").addEventListener("click", () => {
        window.history.back(); // 🔥 이전 페이지로 이동
      });
    </script>
    </body>
</html>