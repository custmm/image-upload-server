<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="kMxKqlA9cKbHdJGw51M2sE21fjyzL3SvY1ryWISJMT0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <title>â±¯íœ´ìš±ìŠˆìš±â±¯ >>ìˆ¨ê²¨ì§„ ê²Œì„</title>
    <style>
        /* ëª¨ë°”ì¼(í­ 768px ì´í•˜)ì—ì„œë§Œ í‘œì‹œ */
        @media (max-width: 576px) {
            #mobile-keypad {
                background-color: rgba(0, 0, 0, 0.3);
                padding-top: 10px;
                padding-bottom: 10px;
                padding-left: 25px;
                padding-right: 25px;
                border-radius: 10px;
                position: fixed;
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 20px;
                align-items: center;
                z-index: 10000;
            }

            /* ë™ê·¸ë€ ë°©í–¥ íŒ¨ë“œ */
            .arrow-pad {
                position: relative;
                width: 150px;
                height: 150px;
                border: 2px solid #ccc;
                border-radius: 50%;
                background: #fff;
            }

            .arrow-pad .arrow-btn {
                position: absolute;
                width: 28px;
                height: 28px;
                background: #fff;
                border: 1px solid #ccc;
                border-radius: 4px;
                font-size: 18px;
                color: #000;
                display: flex;
                align-items: center;
                justify-content: center;
                touch-action: none;
            }

            .arrow-btn.up {
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
            }

            .arrow-btn.down {
                bottom: 10px;
                left: 50%;
                transform: translateX(-50%);
            }

            .arrow-btn.left {
                left: 10px;
                top: 50%;
                transform: translateY(-50%);
            }

            .arrow-btn.right {
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
            }

            .arrow-btn.center {
                width: 38px;
                height: 38px;
                border-radius: 50%;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 16px;
            }

            /* H, R ë²„íŠ¼ */
            .action-pad {
                display: flex;
                flex-direction: row;
                gap: 20px;
            }

            .action-btn {
                width: 40px;
                height: 40px;
                background: #fff;
                border: 1px solid #ccc;
                border-radius: 8px;
                font-size: 18px;
                color: #000;
                touch-action: none;
            }

            .arrow-btn.up:hover,
            .arrow-btn.down:hover,
            .arrow-btn.left:hover,
            .arrow-btn.right:hover,
            .arrow-btn.center:hover,
            .action-btn:hover {
                background-color: aqua;
            }

            /* ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” ìˆ¨ê¹€ */
            #mobile-keypad {
                display: flex;
            }
        }

        @media (min-width: 769px) {
            #mobile-keypad {
                display: none;
            }
        }
    </style>
</head>

<body class="game-page no-bg">
    <h1 id="pageTitle">hidden_GAME</h1>
    <div class="game-container" id="gameContainer">
        <h2 id="imageText">ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì—¬ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.</h2>
        <img id="selectedImage" class="selected-image" alt="ì„ íƒëœ ì´ë¯¸ì§€">
    </div>
    <div id="hints-container" style="display: none;">
        <img src="images/game_hint.png" id="gameHint-1" class="game-hint" alt="Game Hint">
        <img src="images/game_hint.png" id="gameHint-2" class="game-hint" alt="Game Hint">
        <img src="images/game_hint.png" id="gameHint-3" class="game-hint" alt="Game Hint">
        <img src="images/game_hint.png" id="gameHint-4" class="game-hint" alt="Game Hint">
    </div>
    <div id="gameHint" style="display:none;">íŒíŠ¸ ë‚´ìš©</div>
    <div id="playerNumber"></div>
    <div id="foundNumbers">ì°¾ì€ ìˆ«ì: </div>
    <div id="victoryScreen">
        <h2>ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ìˆ«ìë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!</h2>
        <button id="pre-button" onclick="location.href='preview.html'">preview.html ì´ë™</button>
    </div>
    <!-- ì¡°ì‘ë²• íŒì—…ì°½ -->
    <div id="instructionsPopup">
        <p>í•´ë‹¹ íŒì—…ì—ì„œ "í™•ì¸"ë²„íŠ¼ì„ í´ë¦­í•œ í›„ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ ê²Œì„ëŒ€ê¸°í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.</p>
        <button id="closePopupButton">í™•ì¸</button>
    </div>
    <!-- ê²Œì„ ì¡°ì‘ë²• íŒì—… -->
    <div id="gameControlsPopup" style="display: none;">
        <div id="popupPage1">
            <h2>ê²Œì„ ì¡°ì‘ë²•</h2>
            <p style="font-weight: bold; text-align: left;">*ìŠ¤í˜ì´ìŠ¤ë°” ==> ìˆ«ì ìƒì„±</p>
            <p style="font-weight: bold; text-align: left;">*ë°©í–¥í‚¤(â†‘,â†“,â†,â†’) ==> ê°ì²´ ì´ë™</p>
            <p style="font-weight: bold; text-align: left;">*Rí‚¤ ==> ê°ì²´ íšŒì „</p>
            <p style="font-weight: bold; text-align: left;">*Hí‚¤ ==> ë‹¤ìŒìˆ«ì ìœ„ì¹˜ë³´ê¸°</p>
            <p style="color:red; font-weight: bold;">spaceë°”ë¥¼ ëˆ„ë¥´ë©´ ìˆ«ìê°€ ì „ë¶€ ì‚¬ë¼ì§€ê¸°ì „ê¹Œì§€ í‚¤ë³´ë“œ ì¡°ì‘ì„ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
            <div>
                <button id="nextButton">ë‹¤ìŒ</button>
            </div>
            <button class="start-game-btn">ê²Œì„ ì‹œì‘</button>
        </div>
        <div id="popupPage2" style="display: none;">
            <h2>ê²Œì„ ë°©ë²•</h2>
            <p>â–¶spaceë°”ë¥¼ ëˆ„ë¥¸í›„ ëœë¤í•œ ìœ„ì¹˜ì— 1~10ê¹Œì§€ì˜ ìˆ«ìë¥¼ ìƒì„±í•œí›„ ì ì  ì˜…ì–´ì§€ë©´ì„œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</p>
            <p>â–¶ìˆ«ìê°€ ì „ë¶€ ì‚¬ë¼ì§€ë©´ "ê²Œì„ì‹œì‘ ë¬¸êµ¬"ê°€ ë‚˜ì˜¨ ë’¤ì— ì´ë™í•˜ë©´ì„œ ìˆ¨ê²¨ì§„ ìˆ«ìë“¤ì„ ì°¾ìœ¼ì‹œë©´ ë©ë‹ˆë‹¤.</p>
            <p>â–¶(ì¤‘ìš”)ê°ì²´ë¥¼ ëˆ„ë¥´ë©´ ë‹¤ì‹œ ì¡°ì‘ë²•ê³¼ ê²Œì„ë°©ë²•ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <div>
                <button id="previewButton">ì´ì „</button>
            </div>
            <button class="start-game-btn">ê²Œì„ ì‹œì‘</button>
        </div>
    </div>
    <audio id="startAudio" src="sounds/game_start.mp3" preload="auto" type="audio/mp3"></audio>
    <audio id="finishAudio" src="sounds/game_finish.mp3" preload="auto" type="audio/mp3"></audio>
    <audio id="ruleAudio" src="sounds/game_rule.mp3" preload="auto" type="audio/mp3"></audio>
    <!-- ëª¨ë°”ì¼ ì „ìš© ê°€ìƒ í‚¤íŒ¨ë“œ -->
    <div id="mobile-keypad">
        <div class="arrow-pad">
            <button data-key="ArrowUp" class="arrow-btn up">â†‘</button>
            <button data-key="ArrowLeft" class="arrow-btn left">â†</button>
            <button data-key="Space" class="arrow-btn center">â£</button>
            <button data-key="ArrowRight" class="arrow-btn right">â†’</button>
            <button data-key="ArrowDown" class="arrow-btn down">â†“</button>
        </div>
        <div class="action-pad">
            <button data-key="H" class="action-btn">H</button>
            <button data-key="R" class="action-btn">R</button>
        </div>
    </div>
    <script>
        // 1. ì§„ì… ì‹œ localStorageì— preview ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì • (ë§Œì•½ ì—†ìœ¼ë©´)
        if (!localStorage.getItem("selectedImage")) {
            const totalPreviews = 12;
            const randomIndex = Math.floor(Math.random() * totalPreviews) + 1;
            localStorage.setItem("selectedImage", `images/preview-gunff_${randomIndex}.png`);
        }

        let isPopupOpen = false;  // âœ… íŒì—… ì—´ë ¤ ìˆëŠ”ì§€ ì—¬ë¶€ë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜

        function gamepopup(message) {
            if (isPopupOpen) return;  // âœ… íŒì—…ì´ ì—´ë ¤ ìˆìœ¼ë©´ ì‹¤í–‰ ì¤‘ë‹¨
            isPopupOpen = true;  // âœ… íŒì—… ì—´ë¦¼ ìƒíƒœë¡œ ë³€ê²½

            // íŒì—… ì˜¤ë²„ë ˆì´(ë°°ê²½ ì»¨í…Œì´ë„ˆ) ìƒì„±
            const overlay = document.createElement("div");
            overlay.classList.add("hint-overlay");

            // íŒì—… ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ ìƒì„± (ì˜¤ë²„ë ˆì´ ë‚´ë¶€ì— ìœ„ì¹˜)
            const popup = document.createElement("hintPopup");
            popup.classList.add("game-popup");

            // ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
            const messageEl = document.createElement("p");
            messageEl.textContent = message;
            popup.appendChild(messageEl);

            // í™•ì¸ ë²„íŠ¼ ìƒì„± (íŒì—… ì»¨í…Œì´ë„ˆ ì•ˆìœ¼ë¡œ ë„£ìŒ)
            const confirmButton = document.createElement("button");
            confirmButton.classList.add("hint-confirm-button");
            confirmButton.textContent = "í™•ì¸";
            confirmButton.addEventListener("click", () => {
                overlay.remove();
                isPopupOpen = false;  // âœ… íŒì—… ë‹«í˜ ìƒíƒœë¡œ ë³€ê²½
                window.location.href = "preview.html"; // âœ… ì´ë™ ì¶”ê°€
            });
            popup.appendChild(confirmButton);

            // íŒì—… ì»¨í…Œì´ë„ˆë¥¼ ì˜¤ë²„ë ˆì´ì— ì¶”ê°€
            overlay.appendChild(popup);

            // ì˜¤ë²„ë ˆì´ë¥¼ ë¬¸ì„œì— ì¶”ê°€í•˜ì—¬ í‘œì‹œ
            document.body.appendChild(overlay);
        }

        function hintpopup(message) {
            if (isPopupOpen) return;  // âœ… íŒì—…ì´ ì—´ë ¤ ìˆìœ¼ë©´ ì‹¤í–‰ ì¤‘ë‹¨
            isPopupOpen = true;  // âœ… íŒì—… ì—´ë¦¼ ìƒíƒœë¡œ ë³€ê²½

            // íŒì—… ì˜¤ë²„ë ˆì´(ë°°ê²½ ì»¨í…Œì´ë„ˆ) ìƒì„±
            const overlay = document.createElement("div");
            overlay.classList.add("hint-overlay");

            // íŒì—… ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ ìƒì„± (ì˜¤ë²„ë ˆì´ ë‚´ë¶€ì— ìœ„ì¹˜)
            const popup = document.createElement("hintPopup");
            popup.classList.add("hint-popup");

            // ë©”ì‹œì§€ ìš”ì†Œ ìƒì„±
            const messageEl = document.createElement("p");
            messageEl.textContent = message;
            popup.appendChild(messageEl);

            // í™•ì¸ ë²„íŠ¼ ìƒì„± (íŒì—… ì»¨í…Œì´ë„ˆ ì•ˆìœ¼ë¡œ ë„£ìŒ)
            const confirmButton = document.createElement("button");
            confirmButton.classList.add("hint-confirm-button");
            confirmButton.textContent = "í™•ì¸";
            confirmButton.addEventListener("click", () => {
                overlay.remove();
                isPopupOpen = false;  // âœ… íŒì—… ë‹«í˜ ìƒíƒœë¡œ ë³€ê²½
            });
            popup.appendChild(confirmButton);

            // íŒì—… ì»¨í…Œì´ë„ˆë¥¼ ì˜¤ë²„ë ˆì´ì— ì¶”ê°€
            overlay.appendChild(popup);

            // ì˜¤ë²„ë ˆì´ë¥¼ ë¬¸ì„œì— ì¶”ê°€í•˜ì—¬ í‘œì‹œ
            document.body.appendChild(overlay);
        }

        document.addEventListener("DOMContentLoaded", function () {
            // ê¸°ì¡´ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const selectedImageSrc = localStorage.getItem("selectedImage");
            const selectedImageElement = document.getElementById("selectedImage");
            const playerNumber = document.getElementById("playerNumber");
            const foundNumbersDisplay = document.getElementById("foundNumbers");
            const victoryScreen = document.getElementById("victoryScreen");
            const audio = document.getElementById("startAudio");
            const audio2 = document.getElementById("finishAudio");
            const audio3 = document.getElementById("ruleAudio");

            // íŒì—… ê´€ë ¨ ìš”ì†Œ
            const closePopupButton = document.getElementById("closePopupButton");
            const gameControlsPopup = document.getElementById("gameControlsPopup");
            const popupPage1 = document.getElementById("popupPage1");
            const popupPage2 = document.getElementById("popupPage2");
            const nextButton = document.getElementById("nextButton");
            const previewButton = document.getElementById("previewButton");
            const startGameButtons = document.querySelectorAll(".start-game-btn");

            // ì „ì—­ ê²Œì„ ìƒíƒœ ë³€ìˆ˜
            let gameStarted = false;         // ê²Œì„ ì‹œì‘ ì—¬ë¶€
            let spacePressed = false;        // ìµœì´ˆ ìŠ¤í˜ì´ìŠ¤ë°” ì…ë ¥ ì—¬ë¶€
            let isGameOver = false;          // ê²Œì„ ì¢…ë£Œ ì—¬ë¶€
            let canMove = false;             // ìˆ«ì ìƒì„±(ìˆ¨ê¹€ íš¨ê³¼) í›„ ì¡°ì‘ ê°€ëŠ¥ ì—¬ë¶€
            let keysPressed = {};            // ë™ì‹œì— ëˆŒë¦° í‚¤ ì €ì¥
            let rotationAngle = 0;           // íšŒì „ ê°ë„
            let rotateInProgress = false; // íšŒì „ ì¤‘ì¸ì§€ ì—¬ë¶€ë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜
            let hiddenNumbers = [];
            let foundNumbers = []; // ğŸ”¹ ì°¾ì€ ìˆ«ìë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´
            let currentNumber = 1;
            let glowInterval = null; // ğŸ”¹ ë²½ ë°œê´‘ íš¨ê³¼ íƒ€ì´ë¨¸
            let cornerTime = 0; // ğŸ”¹ ëª¨ì„œë¦¬ì— ë‹¿ì€ ì´ ëˆ„ì  ì‹œê°„ (ì´ˆ ë‹¨ìœ„)
            let lastCornerCheck = null; // ğŸ”¹ ë§ˆì§€ë§‰ìœ¼ë¡œ ëª¨ì„œë¦¬ì— ë‹¿ì€ ì‹œê°„
            let health = 100; // ğŸ”¹ ì´ˆê¸° ì²´ë ¥ 100%
            const healthDecreaseRate = 100 / 30; // ğŸ”¹ 30ì´ˆ ë™ì•ˆ 100% ê°ì†Œ â†’ 1ì´ˆë‹¹ 3.33%
            const hintMax = 4;
            let hintCount = hintMax;  // ë‚¨ì€ íŒíŠ¸ ê°œìˆ˜
            let usedHintForCurrentNumber = false;  // í˜„ì¬ ìˆ«ìì— ëŒ€í•´ íŒíŠ¸ ì‚¬ìš© ì—¬ë¶€
            let currentTargetNumber = getNextTargetNumber(); // í˜„ì¬ ì°¾ì•„ì•¼ í•  ìˆ«ì

            // selectedImageì— localStorageì—ì„œ ì„¤ì •í•œ ì´ë¯¸ì§€ ê²½ë¡œ ì ìš©
            if (selectedImageSrc) {
                selectedImageElement.src = selectedImageSrc;
            } else {
                selectedImageElement.alt = "ì„ íƒëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.";
            }

            // ì²« í˜ì´ì§€ì˜ "ë‹¤ìŒ" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í˜ì´ì§€ 1 ìˆ¨ê¸°ê³  í˜ì´ì§€ 2 í‘œì‹œ
            if (nextButton) {
                nextButton.addEventListener("click", function () {
                    popupPage1.style.display = "none";
                    popupPage2.style.display = "block";
                });
            }


            // ì²« í˜ì´ì§€ì˜ "ì´ì „" ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ í˜ì´ì§€ 2 ìˆ¨ê¸°ê³  í˜ì´ì§€ 1 í‘œì‹œ
            if (previewButton) {
                previewButton.addEventListener("click", function () {
                    popupPage2.style.display = "none";
                    popupPage1.style.display = "block";
                });
            }

            // ëª¨ë“  ê²Œì„ ì‹œì‘ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë“±ë¡ (í´ë˜ìŠ¤ start-game-btn ì‚¬ìš©)
            startGameButtons.forEach((btn) => {
                btn.addEventListener("click", function () {
                    gameControlsPopup.style.display = "none";
                    gameStarted = true;
                    console.log("ê²Œì„ ì‹œì‘ë¨");
                });
            });

            let instructionsClosed = false; // ğŸ”¹ íŒì—…ì´ ë‹«í˜”ëŠ”ì§€ í™•ì¸

            // ğŸ”¹ 1ï¸âƒ£ ì¡°ì‘ë²• íŒì—… ë‹«ê¸°
            closePopupButton.addEventListener("click", function () {
                instructionsPopup.style.display = "none";
                instructionsClosed = true; // ğŸ”¹ íŒì—…ì´ ë‹«í˜ ìƒíƒœë¡œ ë³€ê²½
                console.log("ì¡°ì‘ë²• ì•ˆë‚´ì°½ ë‹«í˜, ìŠ¤í˜ì´ìŠ¤ë°” ì…ë ¥ ê°€ëŠ¥");
            });

            // ğŸ”¹ 2ï¸âƒ£ ì´ë¯¸ì§€ í´ë¦­ ì‹œ ê²Œì„ ì¡°ì‘ë²• íŒì—… í‘œì‹œ
            selectedImageElement.addEventListener("click", function () {
                if (!instructionsClosed) { // ğŸ”¹ ì¡°ì‘ë²• íŒì—…ì´ ë‹«íŒ ê²½ìš°ë§Œ ì‹¤í–‰
                    console.log("âŒ ì¡°ì‘ë²• ì•ˆë‚´ì°½ì´ ì—´ë ¤ìˆì–´ ê²Œì„ ëŒ€ê¸°í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }
                gameControlsPopup.style.display = "block";
                console.log("ê²Œì„ ì¡°ì‘ë²• ì•ˆë‚´ì°½ í‘œì‹œ...");
            });

            // ğŸ”¹ ê²Œì„ ì‹œì‘ (í´ë¦­ ì‹œ)
            selectedImageElement.addEventListener("click", function () {
                if (!instructionsClosed) { // ğŸ”¹ ì¡°ì‘ë²• íŒì—…ì´ ì—´ë ¤ìˆìœ¼ë©´ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
                    console.log("ğŸš« ì¡°ì‘ë²• ì•ˆë‚´ì°½ì´ ì—´ë ¤ìˆì–´ ê²Œì„ì´ ì‹œì‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }

                const rect = selectedImageElement.getBoundingClientRect();
                const offsetTop = rect.top + window.scrollY;
                const offsetLeft = rect.left + window.scrollX;

                document.getElementById("pageTitle").style.display = "none";
                document.getElementById("imageText").style.display = "none";
                selectedImageElement.style.border = "none";
                selectedImageElement.style.position = "absolute";
                selectedImageElement.style.top = `${offsetTop}px`;
                selectedImageElement.style.left = `${offsetLeft}px`;
                selectedImageElement.style.transform = "none";

                if (!gameStarted) {
                    gameStarted = true;
                    console.log("ğŸ® ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ ìˆ«ìë¥¼ í™œì„±í™”í•˜ì„¸ìš”.");
                }
            });

            // ì²´ë ¥ë°” ìƒì„± í•¨ìˆ˜ (ì´ê±¸ ì‹¤í–‰í•˜ë©´ ì´ë™ ê°€ëŠ¥)
            function createHealthBar() {
                if (!document.getElementById("healthBarContainer")) {
                    const healthBarContainer = document.createElement("div");
                    healthBarContainer.id = "healthBarContainer";
                    healthBarContainer.style.position = "fixed";
                    healthBarContainer.style.top = "10px";
                    healthBarContainer.style.left = "50%";
                    healthBarContainer.style.transform = "translateX(-50%)";
                    healthBarContainer.style.width = "200px";
                    healthBarContainer.style.height = "20px";
                    healthBarContainer.style.backgroundColor = "#ddd";
                    healthBarContainer.style.border = "2px solid #000";
                    healthBarContainer.style.borderRadius = "5px";
                    healthBarContainer.style.overflow = "hidden";
                    healthBarContainer.style.display = "flex";
                    healthBarContainer.style.alignItems = "center";
                    healthBarContainer.style.justifyContent = "flex-start"; // ì™¼ìª½ ì •ë ¬

                    const healthBar = document.createElement("div");
                    healthBar.id = "healthBar";
                    healthBar.style.width = "100%";
                    healthBar.style.height = "100%";
                    healthBar.style.backgroundColor = "#4CAF50";
                    healthBar.style.transition = "width 0.5s ease"; // ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜
                    healthBar.style.transformOrigin = "right"; // ğŸ”¹ ì˜¤ë¥¸ìª½ ëì„ ê¸°ì¤€ìœ¼ë¡œ ì¤„ì–´ë“¤ë„ë¡ ì„¤ì •

                    healthBarContainer.appendChild(healthBar);
                    document.body.appendChild(healthBarContainer);

                    canMove = true; // ğŸ”¹ ì²´ë ¥ë°”ê°€ ìƒì„±ëœ í›„ ì´ë™ ê°€ëŠ¥
                }
            }

            // ğŸ”¹ ì²´ë ¥ ê°ì†Œ í•¨ìˆ˜
            function decreaseHealth(amount) {
                if (health > 0) {
                    health -= amount;
                    if (health < 0) health = 0;

                    // ì²´ë ¥ë°” ì—…ë°ì´íŠ¸
                    const healthBar = document.getElementById("healthBar");
                    healthBar.style.width = `${health}%`;

                    console.log(`ğŸ”¥ ì²´ë ¥ ê°ì†Œ! í˜„ì¬ ì²´ë ¥: ${health}%`);

                    if (health === 0) {
                        gamepopup("ğŸ’€ ì²´ë ¥ì´ 0ì´ ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ë™ ë¶ˆê°€!");
                        canMove = false;
                        isGameOver = true;
                    }
                }
            }

            // ğŸ”¹ ëª¨ì„œë¦¬ ë‹¿ìŒ ì²´í¬ í•¨ìˆ˜ (30ì´ˆ ëˆ„ì  ì‹œ ì²´ë ¥ ê°ì†Œ)
            function checkWallAndCornerContact() {
                if (!canMove) return;

                const threshold = 5;
                let left = parseInt(selectedImageElement.style.left) || selectedImageElement.getBoundingClientRect().left;
                let top = parseInt(selectedImageElement.style.top) || selectedImageElement.getBoundingClientRect().top;
                let maxX = window.innerWidth - selectedImageElement.clientWidth;
                let maxY = window.innerHeight - selectedImageElement.clientHeight;

                // ğŸ”¹ ë²½ ì²´í¬ (ì™¼ìª½, ì˜¤ë¥¸ìª½, ìœ„ìª½, ì•„ë˜ìª½)
                const isNearWall =
                    (left <= threshold) ||
                    (left >= maxX - threshold) ||
                    (top <= threshold) ||
                    (top >= maxY - threshold);

                // ğŸ”¹ ëª¨ì„œë¦¬ ì²´í¬ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
                const isInCorner =
                    (left <= threshold && top <= threshold) ||
                    (left >= maxX - threshold && top <= threshold) ||
                    (left <= threshold && top >= maxY - threshold) ||
                    (left >= maxX - threshold && top >= maxY - threshold);

                if (isNearWall || isInCorner) {
                    let currentTime = Date.now();

                    if (lastCornerCheck === null) {
                        lastCornerCheck = currentTime;
                    }

                    let elapsed = (currentTime - lastCornerCheck) / 1000;
                    cornerTime += elapsed;
                    lastCornerCheck = currentTime;

                    if (cornerTime >= 1) {
                        let damage = healthDecreaseRate;
                        decreaseHealth(damage);
                        console.log(`âš ï¸ ì²´ë ¥ ê°ì†Œ: ${damage}%`);
                        cornerTime -= 1;
                    }
                } else {
                    lastCornerCheck = null;
                }
            }

            // ğŸ”¹ 0.1ì´ˆë§ˆë‹¤ ë²½ & ëª¨ì„œë¦¬ ì¶©ëŒ ê°ì§€ (ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆ„ë¥¸ í›„ì—ë§Œ ì‹¤í–‰ë¨)
            setInterval(() => {
                checkWallAndCornerContact();
            }, 100);

            // ğŸ”¹ ë²½ ê²½ê³  íš¨ê³¼ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateWallGlow(left, top, maxX, maxY) {
                const glowThreshold = 40;
                let glowBox = document.getElementById("wallGlow");

                if (!glowBox) {
                    glowBox = document.createElement("div");
                    glowBox.id = "wallGlow";
                    glowBox.style.position = "fixed";
                    glowBox.style.top = "0";
                    glowBox.style.left = "0";
                    glowBox.style.width = "100vw";
                    glowBox.style.height = "100vh";
                    glowBox.style.pointerEvents = "none";
                    document.body.appendChild(glowBox);
                }

                let glowEffect = "";

                if (left <= glowThreshold) glowEffect += "inset 10px 0px 20px red, ";
                if (top <= glowThreshold) glowEffect += "inset 0px 10px 20px red, ";
                if (left >= maxX - glowThreshold) glowEffect += "inset -10px 0px 20px red, ";
                if (top >= maxY - glowThreshold) glowEffect += "inset 0px -10px 20px red, ";

                if (glowEffect) {
                    if (!glowInterval) {
                        glowInterval = setInterval(() => {
                            glowBox.style.boxShadow = glowBox.style.boxShadow === "none" ? glowEffect.slice(0, -2) : "none";
                        }, 300);
                    }
                } else {
                    if (glowInterval) {
                        clearInterval(glowInterval);
                        glowInterval = null;
                    }
                    glowBox.style.boxShadow = "none";
                }
            }

            let numbersGenerated = false;

            function generateNumbers() {
                let hintElement = document.getElementById("gameHint");
                console.log("gameHint ìš”ì†Œ í™•ì¸:", hintElement); // â— ë””ë²„ê¹…ìš©

                if (!hintElement) {
                    console.error("âŒ gameHint ìš”ì†Œê°€ ì—†ìŠµë‹ˆë‹¤!");
                    return;
                }

                hiddenNumbers = [];
                foundNumbers = [];
                foundNumbersDisplay.style.display = "none";
                foundNumbersDisplay.textContent = "ì°¾ì€ ìˆ«ì: ";

                const threshold = 40;
                for (let i = 1; i <= 10; i++) {
                    let x = Math.random() * (window.innerWidth - 100);
                    let y = Math.random() * (window.innerHeight - 100);

                    if (x < threshold) x += threshold;
                    if (y < threshold) y += threshold;
                    if (x > window.innerWidth - threshold - 50) x -= threshold;
                    if (y > window.innerHeight - threshold - 50) y -= threshold;

                    hiddenNumbers.push({ number: i, x, y });

                    let numElem = document.createElement("div");
                    numElem.classList.add("hidden-number", "number");
                    numElem.setAttribute("data-value", i); // âœ… `data-value` ì¶”ê°€  
                    numElem.textContent = i;

                    // ê³ ì •ëœ ìœ„ì¹˜ì— í‘œì‹œë˜ë„ë¡ ì ˆëŒ€ ìœ„ì¹˜ ì§€ì •
                    numElem.style.position = "absolute";
                    numElem.style.left = `${x}px`;
                    numElem.style.top = `${y}px`;
                    numElem.style.transition = "opacity 25s ease";
                    numElem.style.opacity = 1;
                    document.body.appendChild(numElem);

                    // ì¦‰ì‹œ íˆ¬ëª…í•´ì§€ë„ë¡ ì„¤ì • (25ì´ˆ ë™ì•ˆ fade-out)
                    setTimeout(() => {
                        numElem.style.opacity = 0;
                    }, 0);

                    // 25ì´ˆ í›„ ì—˜ë¦¬ë¨¼íŠ¸ ì œê±°
                    setTimeout(() => {
                        numElem.style.display = "none";
                    }, 25000);
                }
                // ğŸ† "ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤" ë¬¸êµ¬ ìƒì„± ë° ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
                setTimeout(() => {
                    showGameStartMessage();
                }, 25000);
            }

            // âœ… "ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ ìƒì„± ë° ì• ë‹ˆë©”ì´ì…˜ ì ìš©
            function showGameStartMessage() {
                let messageElem = document.createElement("div");
                messageElem.textContent = "ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!";
                messageElem.style.position = "fixed";
                messageElem.style.top = "50%";
                messageElem.style.left = "-50%"; // ì™¼ìª½ í™”ë©´ ë°–ì—ì„œ ì‹œì‘
                messageElem.style.transform = "translate(-50%, -50%)";
                messageElem.style.fontSize = "40px";
                messageElem.style.fontWeight = "bold";
                messageElem.style.color = "black";
                messageElem.style.padding = "20px 40px";
                messageElem.style.borderRadius = "10px";
                messageElem.style.boxShadow = "0 0 10px rgba(255, 255, 255, 0.8)";
                messageElem.style.zIndex = "9999";
                messageElem.style.transition = "left 1.5s ease-in-out"; // ì™¼ìª½ -> ì¤‘ì•™ ì´ë™
                messageElem.style.whiteSpace = "nowrap"; // âœ… ì¤„ë°”ê¿ˆ ë°©ì§€ ì¶”ê°€

                document.body.appendChild(messageElem);

                // ğŸµ âœ… MP3 íŒŒì¼ ì¬ìƒ ì½”ë“œ ì¶”ê°€
                let audio = new Audio("sounds/game_start.mp3");  // MP3 íŒŒì¼ ê²½ë¡œ ì§€ì •
                audio.play().catch(e => console.error("ğŸ”‡ ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:", e));

                // ì¤‘ì•™ìœ¼ë¡œ ì´ë™
                setTimeout(() => {
                    messageElem.style.left = "50%";
                }, 100);

                // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì‚¬ë¼ì§
                setTimeout(() => {
                    messageElem.style.left = "150%";
                }, 1600);

                // ë©”ì‹œì§€ ì œê±° í›„ ê¸°ì¡´ UI ì—…ë°ì´íŠ¸ ì‹¤í–‰
                setTimeout(() => {
                    document.body.removeChild(messageElem);
                    canMove = true;
                    numbersGenerated = true; // ğŸ”¹ ìˆ«ì ìƒì„± ì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½
                    updateHintVisibility();
                    updateHintUI(); // âœ… íŒíŠ¸ UI ì—…ë°ì´íŠ¸ ì¶”ê°€
                    console.log("ğŸ” ìˆ«ìë¥¼ ì°¾ìœ¼ì„¸ìš”!");
                    foundNumbersDisplay.style.display = "block";
                }, 2500);
            }

            function updateHintVisibility() {
                let hintElements = document.querySelectorAll(".game-hint"); // ëª¨ë“  íŒíŠ¸ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                console.log("ğŸ” game-hint ìš”ì†Œ ê°œìˆ˜:", hintElements.length);

                if (hintElements.length === 0) {
                    console.error("âŒ gameHint ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                    return;
                }

                hintElements.forEach(hint => {
                    hint.style.display = "block"; // ëª¨ë“  íŒíŠ¸ë¥¼ í‘œì‹œ
                });

                console.log("âœ… íŒíŠ¸ê°€ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!");
            }

            // í†µí•©ëœ keydown ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.addEventListener("keydown", function (event) {
                if (event.code === "F5" || event.code === "F12") return;

                // ì¡°ì‘ë²• íŒì—…ì´ ë‹«íˆê¸° ì „ì—ëŠ” ìŠ¤í˜ì´ìŠ¤ë°” ë¹„í™œì„±í™”
                if (!instructionsClosed) {
                    event.preventDefault();
                    console.log("ì¡°ì‘ë²• ì°½ì´ ë‹«íˆê¸° ì „ê¹Œì§€ ìŠ¤í˜ì´ìŠ¤ë°” ì…ë ¥ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.");
                    return;
                }

                // ê²Œì„ì€ ì‹œì‘ë˜ì—ˆì§€ë§Œ ì•„ì§ ìˆ«ì ìƒì„±(ìˆ¨ê¹€ íš¨ê³¼)ì´ ì™„ë£Œë˜ì§€ ì•Šì•„ canMoveê°€ falseì¸ ê²½ìš°
                if (gameStarted && !numbersGenerated) {
                    // ì—­ì‹œ ì˜¤ì§ ìŠ¤í˜ì´ìŠ¤ë°”ë§Œ í—ˆìš©
                    if (event.code !== "Space") {
                        event.preventDefault();
                        console.log("ìˆ«ì ìƒì„± ì „: ìŠ¤í˜ì´ìŠ¤ë°” ì…ë ¥ë§Œ í—ˆìš©ë©ë‹ˆë‹¤.");
                        return;
                    }

                    // ìŠ¤í˜ì´ìŠ¤ë°” ì…ë ¥ ì²˜ë¦¬ (ì´ë¯¸ ì²˜ë¦¬ëœ ê²½ìš° ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€í•˜ë ¤ë©´ ì¶”ê°€ ì¡°ê±´ í•„ìš”í•  ìˆ˜ ìˆìŒ)
                    if (!spacePressed) {
                        spacePressed = true;
                        console.log("ìŠ¤í˜ì´ìŠ¤ë°” ëˆ„ë¦„(ìˆ«ì ìƒì„± ì „): ìˆ«ì ìƒì„± ì‹œì‘");
                        generateNumbers();
                        moveCharacter();
                        handleSpacebar(event);
                    }
                    return;
                }

                // ê²Œì„ì´ ì‹œì‘ë˜ì—ˆê³ , canMoveê°€ trueì¸ ìƒíƒœì—ì„œëŠ” ì •ìƒì ìœ¼ë¡œ í‚¤ ì…ë ¥ ì²˜ë¦¬
                if (numbersGenerated && canMove) {
                    if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight"].includes(event.key)) {
                        console.log(`ë°©í–¥í‚¤ ${event.code} ì…ë ¥ë¨`);
                        handleMovement(event);
                    }
                    else if ((event.key === 'H' || event.key === 'h') && canMove) {

                        // 1) íŒíŠ¸ ë‚¨ì€ ê°œìˆ˜ ì²´í¬
                        if (hintCount <= 0) {
                            hintpopup('ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤!');
                            let audio = new Audio("sounds/game_rule.mp3");  // MP3 íŒŒì¼ ê²½ë¡œ ì§€ì •
                            audio.play().catch(e => console.error("ğŸ”‡ ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:", e));
                            return;
                        }

                        // 2) ì´ë¯¸ í˜„ì¬ ìˆ«ìì— ëŒ€í•´ ì‚¬ìš©í–ˆëŠ”ì§€ ì²´í¬
                        if (usedHintForCurrentNumber) {
                            hintpopup('ì—¬ëŸ¬ë²ˆ ì•Œë ¤ë“œë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                            let audio = new Audio("sounds/game_rule.mp3");  // MP3 íŒŒì¼ ê²½ë¡œ ì§€ì •
                            audio.play().catch(e => console.error("ğŸ”‡ ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:", e));
                            return;
                        }

                        // 3) íŒíŠ¸ ì†Œëª¨ & ì•„ì´ì½˜ ì œê±°
                        hintCount--;
                        usedHintForCurrentNumber = true;
                        const hints = document.querySelectorAll('#hints-container .game-hint');
                        if (hints.length > 0) {
                            hints[hints.length - 1].remove();
                        }
                        console.log(`H í‚¤ ì…ë ¥ë¨ - ë‚¨ì€ íŒíŠ¸ ê°œìˆ˜: ${hints.length}`);

                        // 4) (ê¸°ì¡´ ë¡œì§) ë‹¤ìŒ ëª©í‘œ ê°±ì‹  ë° í‘œì‹ ìƒì„±
                        let newTarget = getNextTargetNumber();
                        if (!newTarget) {
                            console.error("ğŸš¨ ëª¨ë“  ìˆ«ìë¥¼ ì°¾ìŒ!");
                            return;
                        }

                        console.log("ğŸŸ¢ ìƒˆë¡œìš´ ëª©í‘œ ìˆ«ì ì‹œë„:", newTarget);

                        currentTargetNumber = newTarget.number; // ğŸ“Œ ìˆ«ì ê°±ì‹ 
                        currentTargetX = newTarget.x; // ğŸ“Œ X ì¢Œí‘œ ê°±ì‹ 
                        currentTargetY = newTarget.y; // ğŸ“Œ Y ì¢Œí‘œ ê°±ì‹ 

                        // ê¸°ì¡´ í‘œì‹ ì œê±° (ì¤‘ë³µ ìƒì„± ë°©ì§€)
                        let oldMarker = document.getElementById("hint-marker");
                        if (oldMarker) oldMarker.remove();

                        // âœ… ìƒˆë¡œìš´ ì›í˜• í‘œì‹ ìƒì„±
                        let hintMarker = document.createElement("div");
                        hintMarker.id = "hint-marker";  // ê³ ìœ  ID ë¶€ì—¬
                        hintMarker.style.position = "absolute";
                        hintMarker.style.left = `${currentTargetX}px`; // ì›ì˜ ì¤‘ì‹¬ ë§ì¶”ê¸°
                        hintMarker.style.top = `${currentTargetY}px`;
                        hintMarker.style.width = "40px";
                        hintMarker.style.height = "40px";
                        hintMarker.style.borderRadius = "50%";
                        hintMarker.style.backgroundColor = "rgba(255, 255, 0, 0.7)";
                        hintMarker.style.zIndex = "9999";
                        hintMarker.style.transition = "opacity 1s ease-out"; // ì„œì„œíˆ ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€

                        document.body.appendChild(hintMarker);

                        console.log("ğŸ”„ ê°±ì‹ ëœ ëª©í‘œ ìˆ«ì:", currentTargetNumber);
                    }
                    else if ((event.key === "r" || event.key === "R") && canMove) {
                        rotateInProgress = true; // íšŒì „ ì‹œì‘
                        console.log("Rí‚¤ ì…ë ¥ ê°ì§€, íšŒì „ ì‹œì‘");
                        rotateCharacter();
                    }
                }
            });

            // íŒíŠ¸ UI ì´ˆê¸°í™”
            function updateHintUI() {
                const hintContainer = document.getElementById('hints-container');
                hintContainer.innerHTML = '';  // ê¸°ì¡´ íŒíŠ¸ ì´ˆê¸°í™”

                for (let i = 0; i < 4; i++) { // âœ… íŒíŠ¸ ê°œìˆ˜ 4ê°œë¡œ ê³ ì •
                    let hintIcon = document.createElement('img');
                    hintIcon.src = 'images/game_hint.png';
                    hintIcon.classList.add('game-hint');
                    hintContainer.appendChild(hintIcon);
                }

                // âœ… íŒíŠ¸ ì»¨í…Œì´ë„ˆ í‘œì‹œ
                hintContainer.style.display = "flex";
            }

            // íŒíŠ¸ ì‚¬ìš© í•¨ìˆ˜
            function useHint() {
                let targetInfo = getNextTargetNumber(); // ğŸ“Œ ì •í™•í•œ ìˆ«ìì™€ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                if (!targetInfo) {
                    alert('ëª¨ë“  ìˆ«ìë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤!');
                    return;
                }

                let targetElement = document.querySelector(`.hidden-number.number[data-value='${targetInfo.number}']`);
                if (targetElement) {
                    // âœ… ìˆ«ì ê°•ì¡° íš¨ê³¼ ì¶”ê°€
                    targetElement.style.border = "4px solid yellow";
                    targetElement.style.backgroundColor = "rgba(255, 255, 0, 0.7)";
                    targetElement.style.transition = "all 0.5s ease-in-out";

                    // âœ… ê¹œë¹¡ì´ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ (íŒíŠ¸ íš¨ê³¼)
                    targetElement.animate([
                        { transform: "scale(1)", opacity: 1 },
                        { transform: "scale(1.3)", opacity: 0.6 },
                        { transform: "scale(1)", opacity: 1 }
                    ], {
                        duration: 800,
                        iterations: 3
                    });

                    hintCount--; // íŒíŠ¸ ì°¨ê°
                    usedHintForCurrentNumber = true; // ê°™ì€ ìˆ«ìì— ëŒ€í•´ ë‹¤ì‹œ ì‚¬ìš© ë¶ˆê°€
                    updateHintUI();
                    console.log(`ğŸ” íŒíŠ¸ ì‚¬ìš©ë¨ - ìˆ«ì ${targetInfo.number} ìœ„ì¹˜: (${targetInfo.x}px, ${targetInfo.y}px)`);
                }
            }

            // ìˆ«ìë¥¼ ì°¾ì•˜ì„ ë•Œ ì´ë²¤íŠ¸ ì²˜ë¦¬
            function onNumberFound(number) {
                console.log(`âœ… ìˆ«ì ${number} ì°¾ìŒ!`);

                if (!foundNumbers.includes(number)) {
                    foundNumbers.push(number); // ğŸ“Œ ì°¾ì€ ìˆ«ì ëª©ë¡ì— ì¶”ê°€
                    console.log(`ğŸ“Œ ì—…ë°ì´íŠ¸ëœ ì°¾ì€ ìˆ«ì ëª©ë¡:`, foundNumbers);
                }

                // ğŸ“Œ **ì°¾ì€ ìˆ«ìì˜ ì›í˜• ê°•ì¡° íš¨ê³¼ ì œê±°**
                let foundElement = document.querySelector(`.hidden-number.number[data-value="${number}"]`);
                if (foundElement && foundElement.dataset.highlighted) {
                    console.log(`ğŸ”µ ìˆ«ì ${number}ì˜ ê°•ì¡° íš¨ê³¼ ì œê±°`);

                    // âœ… opacityë¥¼ ì¤„ì—¬ ì„œì„œíˆ ì‚¬ë¼ì§€ê²Œ ì„¤ì •
                    foundElement.style.transition = "opacity 1s ease-out"; // 1ì´ˆ ë™ì•ˆ ì„œì„œíˆ ì‚¬ë¼ì§
                    foundElement.style.opacity = "0";

                    // âœ… 1ì´ˆ í›„ ì™„ì „íˆ ìˆ¨ê¹€ ì²˜ë¦¬
                    setTimeout(() => {
                        foundElement.style.display = "none"; // ìµœì¢…ì ìœ¼ë¡œ ì™„ì „íˆ ì œê±°
                        foundElement.style.border = "none";
                        foundElement.style.backgroundColor = "transparent";
                        foundElement.style.width = "";
                        foundElement.style.height = "";
                        foundElement.style.borderRadius = "";
                        foundElement.style.color = "";  // ê¸€ì ë‹¤ì‹œ ë³´ì´ê²Œ
                        foundElement.style.textShadow = "";

                        // âœ… datasetì—ì„œ ê°•ì¡° í‘œì‹œ ì œê±°
                        delete foundElement.dataset.highlighted;
                    }, 1000);
                }

                let newTarget = getNextTargetNumber();
                if (newTarget !== null) {
                    console.log(`ğŸ”„ ìƒˆë¡œìš´ ëª©í‘œ ìˆ«ì ê°±ì‹ :`, newTarget);
                    currentTargetNumber = newTarget;
                } else {
                    console.error("ğŸš¨ ë” ì´ìƒ ì°¾ì„ ìˆ«ìê°€ ì—†ìŠµë‹ˆë‹¤!");
                }
            }

            function highlightTargetNumber(targetNumber) {
                if (!targetNumber) {
                    console.error("âŒ ê°•ì¡°í•  ìˆ«ìê°€ ì—†ìŠµë‹ˆë‹¤. targetNumber:", targetNumber);
                    return;
                }

                console.log(`ğŸ”¦ ìˆ«ì ${targetNumber} ê°•ì¡° í‘œì‹œ (í‘œì‹ ìƒì„±)`);

                // ğŸ“Œ **ëª©í‘œ ìˆ«ìì˜ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°**
                let targetElement = document.querySelector(`.hidden-number.number[data-value="${targetNumber}"]`);

                if (!targetElement) {
                    console.error(`âŒ ê°•ì¡°í•  ìˆ«ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (targetNumber: ${targetNumber})`);
                    return;
                }

                let rect = targetElement.getBoundingClientRect();  // ìˆ«ìì˜ ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                let scrollX = window.scrollX || document.documentElement.scrollLeft;
                let scrollY = window.scrollY || document.documentElement.scrollTop;

                let elementWidth = targetElement.offsetWidth;  // ìˆ«ì ìš”ì†Œì˜ ë„ˆë¹„
                let elementHeight = targetElement.offsetHeight; // ìˆ«ì ìš”ì†Œì˜ ë†’ì´

                // ğŸ“Œ ìˆ«ìì˜ **ì¤‘ì•™ ì¢Œí‘œ**ë¥¼ ê³„ì‚°í•˜ì—¬ í‘œì‹ì„ ì •ì¤‘ì•™ì— ìœ„ì¹˜
                let targetX = rect.left + scrollX + elementWidth / 2;
                let targetY = rect.top + scrollY + elementHeight / 2;

                // ê¸°ì¡´ í‘œì‹ ì œê±° (ì¤‘ë³µ ìƒì„± ë°©ì§€)
                let oldMarker = document.getElementById("hint-marker");
                if (oldMarker) oldMarker.remove();

                // âœ… ìƒˆë¡œìš´ ì›í˜• í‘œì‹ ìƒì„±
                let hintMarker = document.createElement("div");
                hintMarker.id = "hint-marker";  // ê³ ìœ  ID ë¶€ì—¬
                hintMarker.style.position = "absolute";
                hintMarker.style.left = `${targetX}px`; // ì›ì˜ ì¤‘ì‹¬ ë§ì¶”ê¸°
                hintMarker.style.top = `${targetY}px`;
                hintMarker.style.width = "40px";
                hintMarker.style.height = "40px";
                hintMarker.style.borderRadius = "50%";
                hintMarker.style.backgroundColor = "rgba(255, 255, 0, 0.7)"; // ë°˜íˆ¬ëª…í•œ ë…¸ë€ìƒ‰
                hintMarker.style.zIndex = "9999";
                hintMarker.style.transition = "opacity 1s ease-out"; // ì„œì„œíˆ ì‚¬ë¼ì§€ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€

                document.body.appendChild(hintMarker);

                console.log(`âœ… íŒíŠ¸ ì‚¬ìš©ë¨ - ìˆ«ì ${targetNumber} ìœ„ì¹˜ (${targetX}, ${targetY})ì— ì›í˜• í‘œì‹ í‘œì‹œë¨`);
            }


            // âœ… ì•ˆì „í•˜ê²Œ ëª©í‘œ ìˆ«ìë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (ëœë¤ ë°©ì‹ ì ìš©)
            function getNextTargetNumber() {
                let numbers = Array.from(document.querySelectorAll('.hidden-number.number'));

                // **ğŸ”¹ ìˆ«ìë¥¼ ì‘ì€ ìˆœì„œëŒ€ë¡œ ì •ë ¬ (1ë¶€í„° 10ê¹Œì§€)**
                numbers.sort((a, b) => {
                    let numA = parseInt(a.textContent.trim(), 10);
                    let numB = parseInt(b.textContent.trim(), 10);
                    return numA - numB;
                });

                console.log("ğŸ“Œ í˜„ì¬ ì°¾ì€ ìˆ«ì ëª©ë¡:", foundNumbers);

                for (let numElem of numbers) {
                    let targetValue = parseInt(numElem.textContent.trim(), 10);

                    // **âœ… ì°¾ì§€ ì•Šì€ ìˆ«ìë§Œ ì„ íƒ**
                    if (foundNumbers.includes(targetValue)) continue;

                    let wasHidden = false;

                    // **ğŸ”¹ ìˆ«ìê°€ `display: none` ìƒíƒœì¸ì§€ í™•ì¸**
                    if (window.getComputedStyle(numElem).display === "none") {
                        numElem.style.display = "block";  // **ì„ì‹œë¡œ ë³´ì´ê²Œ ë³€ê²½**
                        wasHidden = true;
                    }

                    let rect = numElem.getBoundingClientRect();  // ğŸ“Œ ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
                    let targetX = rect.left + window.scrollX;  // ë·°í¬íŠ¸ ì¢Œí‘œë¥¼ í˜ì´ì§€ ì¢Œí‘œë¡œ ë³€í™˜
                    let targetY = rect.top + window.scrollY;

                    // **ğŸ”¹ ë‹¤ì‹œ ìˆ¨ê¹€ ì²˜ë¦¬**
                    if (wasHidden) {
                        numElem.style.display = "none";
                    }

                    console.log(`ğŸ¯ ë‹¤ìŒ ëª©í‘œ ìˆ«ì: ${targetValue}, ìœ„ì¹˜: (${targetX}px, ${targetY}px)`);

                    // âœ… **ìƒˆë¡œìš´ ìˆ«ì ì„¤ì • í›„ ê°•ì¡° í‘œì‹œ**
                    currentTargetNumber = targetValue;
                    currentTargetX = targetX;
                    currentTargetY = targetY;

                    highlightTargetNumber(currentTargetNumber);

                    return { number: targetValue, x: targetX, y: targetY };
                }

                console.log("âš ï¸ ëª¨ë“  ìˆ«ìë¥¼ ì°¾ìŒ - ë” ì´ìƒ ëª©í‘œ ìˆ«ì ì—†ìŒ");
                return null;
            }

            function checkNumberFound() {
                if (!canMove) return;

                let left = parseInt(selectedImage.style.left) || selectedImage.getBoundingClientRect().left;
                let top = parseInt(selectedImage.style.top) || selectedImage.getBoundingClientRect().top;

                let target = hiddenNumbers.find(n => n.number === currentNumber);
                if (!target) return;

                // ìˆ«ì ìœ„ì¹˜ ê·¼ì²˜ì¸ì§€ ì²´í¬ (50px ë²”ìœ„)
                if (Math.abs(left - target.x) < 50 && Math.abs(top - target.y) < 50) {
                    console.log(`âœ… ìˆ«ì ${currentNumber} ì°¾ìŒ!`);

                    foundNumbers.push(currentNumber);
                    foundNumbersDisplay.textContent = `ì°¾ì€ ìˆ«ì: ${foundNumbers.join(", ")}`;

                    playerNumber.textContent = currentNumber;
                    playerNumber.style.left = `${left}px`;
                    playerNumber.style.top = `${top - 30}px`;
                    playerNumber.style.display = "block";

                    // ìˆ«ìë¥¼ ì°¾ì€ ìœ„ì¹˜(target.x, target.y)ì— PNG ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                    let pngElement = document.createElement("img");
                    pngElement.src = "images/game_check.png"; // ì‹¤ì œ PNG íŒŒì¼ ê²½ë¡œë¡œ ë³€ê²½í•˜ì„¸ìš”.
                    pngElement.style.position = "absolute";
                    pngElement.style.left = `${target.x}px`;
                    pngElement.style.top = `${target.y}px`;
                    pngElement.style.width = "50px";  // ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì •
                    pngElement.style.height = "50px"; // ì›í•˜ëŠ” í¬ê¸°ë¡œ ì¡°ì •
                    // ì´ PNGëŠ” ì œê±°í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ë‚¨ìŠµë‹ˆë‹¤.
                    document.body.appendChild(pngElement);

                    // âœ… ì²´í¬ ì‚¬ìš´ë“œ ì¬ìƒ ì¶”ê°€
                    const sound = new Audio("sounds/number_catch.mp3"); // íš¨ê³¼ìŒ ê²½ë¡œ
                    sound.play().catch(e => console.warn("ì‚¬ìš´ë“œ ì¬ìƒ ì‹¤íŒ¨:", e));

                    // ğŸ“Œ ìˆ«ì ì°¾ì•˜ì„ ë•Œ í‘œì‹ ì„œì„œíˆ ì‚¬ë¼ì§€ê²Œ í•˜ê¸°
                    let hintMarker = document.getElementById("hint-marker");
                    if (hintMarker) {
                        hintMarker.style.opacity = "0";  // ì ì  íˆ¬ëª…í•´ì§
                        setTimeout(() => hintMarker.remove(), 1000); // 1ì´ˆ í›„ ì‚­ì œ
                    }

                    currentNumber++;
                    usedHintForCurrentNumber = false;  // ë‹¤ìŒ ìˆ«ìì— ëŒ€í•´ íŒíŠ¸ ì¬ì‚¬ìš© ê°€ëŠ¥

                    if (currentNumber > 10) {
                        showVictoryScreen();
                        // ğŸµ âœ… MP3 íŒŒì¼ ì¬ìƒ ì½”ë“œ ì¶”ê°€
                        let audio = new Audio("sounds/game_finish.mp3");  // MP3 íŒŒì¼ ê²½ë¡œ ì§€ì •
                        audio.play().catch(e => console.error("ğŸ”‡ ì˜¤ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:", e));
                    }
                }
            }

            function showVictoryScreen() {
                canMove = false;
                victoryScreen.style.display = "block";
            }

            // ğŸ”¹ ìŠ¤í˜ì´ìŠ¤ë°” ì²˜ë¦¬ í•¨ìˆ˜
            function handleSpacebar(event) {
                if (!gameStarted) {
                    console.log("ğŸš« ê²Œì„ì´ ì•„ì§ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤! ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                    return;
                }
                if (isGameOver) {
                    gamepopup("âŒ ì²´ë ¥ì´ 0ì´ ë˜ì–´ ë” ì´ìƒ ì¡°ì‘í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                    return;
                }

                if (!canMove) {
                    event.preventDefault();
                    createHealthBar();
                    canMove = true;
                    console.log("âœ… ì´ë™ ë° ì¶©ëŒ ê°ì§€ í™œì„±í™”ë¨!");
                }
            }

            // ğŸ”¹ ìºë¦­í„° ì´ë™ ì²˜ë¦¬ í•¨ìˆ˜
            function handleMovement(event) {
                if (!canMove) return;

                keysPressed[event.key] = true;
                moveCharacter();
            }

            // ğŸ”¹ ìºë¦­í„° íšŒì „ í•¨ìˆ˜ (R í‚¤)
            function rotateCharacter() {
                rotationAngle += 3;
                selectedImageElement.style.transform = `rotate(${rotationAngle}deg)`;
                console.log(`ğŸ”„ ìºë¦­í„° íšŒì „: ${rotationAngle}ë„`);
            }

            // ğŸ”¹ ìºë¦­í„° ì´ë™ í•¨ìˆ˜
            function moveCharacter() {
                const step = 8;
                let left = parseInt(selectedImageElement.style.left) || selectedImageElement.getBoundingClientRect().left;
                let top = parseInt(selectedImageElement.style.top) || selectedImageElement.getBoundingClientRect().top;

                // í™”ë©´ ê²½ê³„ ì„¤ì •
                const minX = 0;
                const minY = 0;
                const maxX = window.innerWidth - selectedImageElement.clientWidth;
                const maxY = window.innerHeight - selectedImageElement.clientHeight;

                // ë‹¨ì¼ ë°©í–¥ ì´ë™ (í™”ë©´ ê²½ê³„ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì œí•œ)
                if (keysPressed["ArrowLeft"] && left > minX) selectedImageElement.style.left = `${left - step}px`;
                if (keysPressed["ArrowRight"] && left < maxX) selectedImageElement.style.left = `${left + step}px`;
                if (keysPressed["ArrowUp"] && top > minY) selectedImageElement.style.top = `${top - step}px`;
                if (keysPressed["ArrowDown"] && top < maxY) selectedImageElement.style.top = `${top + step}px`;

                // ëŒ€ê°ì„  ì´ë™ (2ê°œ í‚¤ ì¡°í•©, ê²½ê³„ ì²´í¬ ì¶”ê°€)
                if (keysPressed["ArrowLeft"] && keysPressed["ArrowUp"] && left > minX && top > minY) {
                    selectedImageElement.style.left = `${left - step}px`;
                    selectedImageElement.style.top = `${top - step}px`;
                }
                if (keysPressed["ArrowRight"] && keysPressed["ArrowUp"] && left < maxX && top > minY) {
                    selectedImageElement.style.left = `${left + step}px`;
                    selectedImageElement.style.top = `${top - step}px`;
                }
                if (keysPressed["ArrowLeft"] && keysPressed["ArrowDown"] && left > minX && top < maxY) {
                    selectedImageElement.style.left = `${left - step}px`;
                    selectedImageElement.style.top = `${top + step}px`;
                }
                if (keysPressed["ArrowRight"] && keysPressed["ArrowDown"] && left < maxX && top < maxY) {
                    selectedImageElement.style.left = `${left + step}px`;
                    selectedImageElement.style.top = `${top + step}px`;
                }

                // ë²½ ë°œê´‘ íš¨ê³¼ ì ìš©
                updateWallGlow(left, top, maxX, maxY);

                // ë²½/ëª¨ì„œë¦¬ ë‹¿ìŒ ì²´í¬ (ì²´ë ¥ ê°ì†Œ)
                checkWallAndCornerContact();

                // ìˆ«ì ë°œê²¬ ì²´í¬
                checkNumberFound();
            }

            // í‚¤ë¥¼ ë–¼ë©´ í•´ë‹¹ í‚¤ë¥¼ ê°ì²´ì—ì„œ ì œê±°
            document.addEventListener("keyup", function (event) {
                delete keysPressed[event.key];
            });

            const activeTouches = new Map();

            // ëª¨ë°”ì¼ í‚¤íŒ¨ë“œ í„°ì¹˜ â†’ í‚¤ë³´ë“œ ì´ë²¤íŠ¸ë¡œ ë³€í™˜
            document.querySelectorAll('#mobile-keypad button').forEach(btn => {
                const key = btn.dataset.key;

                btn.addEventListener('touchstart', e => {
                    e.preventDefault();
                    if (activeTouches.has(key)) return; // ì¤‘ë³µ ë°©ì§€

                    const interval = setInterval(() => {
                        document.dispatchEvent(new KeyboardEvent('keydown', { key, code: key }));
                    }, 50); // 50ms ê°„ê²©ìœ¼ë¡œ keydown ë°˜ë³µ ë°œìƒ

                    activeTouches.set(key, interval);
                });

                btn.addEventListener('touchend', e => {
                    e.preventDefault();
                    document.dispatchEvent(new KeyboardEvent('keyup', { key, code: key }));

                    if (activeTouches.has(key)) {
                        clearInterval(activeTouches.get(key));
                        activeTouches.delete(key);
                    }
                });
                btn.addEventListener('touchcancel', e => {
                    e.preventDefault();
                    document.dispatchEvent(new KeyboardEvent('keyup', { key, code: key }));

                    if (activeTouches.has(key)) {
                        clearInterval(activeTouches.get(key));
                        activeTouches.delete(key);
                    }
                });
            });
        });
    </script>
</body>

</html>